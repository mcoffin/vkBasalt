name: Build

on: [push]

jobs:

  ubuntu-make:
    runs-on: ubuntu-latest
    container: ubuntu:eoan

    steps:
    - name: clone
      uses: actions/checkout@v1
      with:
        submodules: recursive

    - name: install-deps
      shell: bash
      run: |
        set -e
        dpkg --add-architecture i386
        apt update
        apt install -y \
          build-essential \
          meson \
          pkg-config pkg-config-i686-linux-gnu \
          gcc-multilib g++-multilib \
          glslang-tools \
          libvulkan-dev libvulkan-dev:i386 \
          vulkan-validationlayers-dev vulkan-validationlayers-dev:i386 \
          libx11-dev libx11-dev:i386 \
          vulkan-tools \
          spirv-tools

    - name: make
      run: |
        make install PREFIX=$(pwd)/results-ubuntu

    - name: upload
      uses: actions/upload-artifact@v1
      with:
        name: vkbasalt-ubuntu-results
        path: results-ubuntu

  archlinux-make:
    runs-on: ubuntu-latest
    container: archlinux:latest

    steps:
    - name: clone
      uses: actions/checkout@v1
      with:
        submodules: recursive

    - name: install-deps
      shell: bash
      run: |
        set -e
        echo '[multilib]' >> /etc/pacman.conf
        echo 'Include = /etc/pacman.d/mirrorlist' >> /etc/pacman.conf
        pacman --noconfirm -Suy
        pacman --noconfirm -S \
          base-devel multilib-devel \
          meson \
          pkgconf \
          vulkan-headers \
          vulkan-validation-layers \
          vulkan-icd-loader lib32-vulkan-icd-loader \
          glslang \
          libx11 lib32-libx11 \
          spirv-tools

    - name: make
      run: |
        make install PREFIX=$(pwd)/results-archlinux

    - name: upload
      uses: actions/upload-artifact@v1
      with:
        name: vkbasalt-archlinux-results
        path: results-archlinux
